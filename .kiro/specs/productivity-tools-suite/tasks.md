# 実装計画

## 推奨実装順序

### Phase 1: 基盤完成（完了済み）
- ✅ プロジェクト基盤構築（1-2）
- ✅ データアクセス層（3）
- ✅ 状態管理層（4）
- ✅ TodoとWBS基本機能（5-6）

### Phase 2: 個別ツール完成（2週間）
1. 共通UIコンポーネント（9）- カンバン・ガントで使用
2. カンバンボード機能（7）
3. ガントチャート機能（8）

### Phase 3: 統合実装（5週間）
1. データモデル統合（10）- 1週間
2. 統合UI基盤（11）- 1週間
3. ビュー間連携（12）- 2週間
4. 高度な機能（13）- 1週間

### Phase 4: 品質保証（1週間）
1. パフォーマンス最適化（14.1）
2. 統合テスト（14.2）
3. 移行準備（15）

## プロジェクト基盤構築

- [x] 1. Next.js 14プロジェクトの初期設定とコア設定
  - Next.js 14（App Router）プロジェクトの作成
  - TypeScript 5.xの設定とstrictモードの有効化
  - Tailwind CSSとShadcn/uiのインストール・設定
  - ESLintとPrettierの設定
  - 基本的なレイアウトコンポーネントの作成
  - _Requirements: すべての要件に共通する基盤設定_

- [x] 2. SQLite WASMのセットアップとデータベース基盤
  - SQLite WASMライブラリの導入と初期化
  - データベーススキーマの定義（todos, wbs_tasks, kanban_cards, gantt_tasks）
  - データベース接続ユーティリティの作成
  - マイグレーション処理の実装
  - データベース操作の基本テストの作成
  - _Requirements: 9.1, 9.2, 9.3_

## データアクセス層

- [x] 3. Repositoryパターンの実装
- [x] 3.1 TodoRepositoryの実装
  - TodoエンティティとDTOの定義
  - CRUD操作メソッドの実装（create, read, update, delete）
  - 検索・フィルタリング機能の実装
  - 期限切れタスクの抽出ロジック
  - Repositoryの単体テストの作成
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 3.2 WBSRepositoryの実装
  - WBSTaskエンティティとDTOの定義（親子関係を含む）
  - 階層構造の保存・取得メソッドの実装
  - 進捗率の自動計算ロジックの実装
  - タスクの並び替え・移動処理の実装
  - Repositoryの単体テストの作成
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 3.3 KanbanRepositoryの実装
  - KanbanCard、KanbanLaneエンティティの定義
  - カードの作成・移動・削除メソッドの実装
  - レーンの管理メソッドの実装
  - WIP制限のバリデーションロジック
  - Repositoryの単体テストの作成
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.4 GanttRepositoryの実装
  - GanttTaskエンティティの定義（依存関係、アイコン、色、カテゴリ、階層構造を含む）
  - タスクのスケジュール管理メソッドの実装
  - 依存関係の検証とクリティカルパス計算
  - 自動日付調整ロジックの実装
  - タスクアイコン、色、メンバー割り当て管理機能
  - タスクグループ管理機能
  - 階層構造管理機能
  - Repositoryの単体テストの作成
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.8, 4.9, 4.10, 4.12, 4.13_

## 状態管理層

- [x] 4. Zustandストアの実装
- [x] 4.1 Todoストアの実装
  - TodoストアのState定義とActions定義
  - RepositoryとのインターフェースとReact Queryの統合
  - 楽観的更新とエラーハンドリングの実装
  - ローカルストレージとの同期処理
  - ストアの統合テストの作成
  - _Requirements: 1.1, 1.2, 1.3, 9.2_

- [x] 4.2 WBSストアの実装
  - WBSストアのState定義（階層構造を含む）
  - タスクの追加・更新・削除アクション
  - ドラッグ&ドロップ時の状態更新処理
  - 進捗率の自動更新ロジック
  - ストアの統合テストの作成
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 4.3 KanbanストアとGanttストアの実装
  - Kanbanストアの実装（カード移動、レーン管理）
  - Ganttストアの実装（タスク期間変更、依存関係管理）
  - ストア間のデータ同期メカニズム
  - 各ストアの統合テストの作成
  - _Requirements: 3.1, 3.2, 4.1, 4.2_

## UIコンポーネント層

- [x] 5. ToDo管理機能のUI実装
- [x] 5.1 TodoコンポーネントとTodoForm
  - TodoListコンポーネントの実装（表示・フィルタリング）
  - TodoFormコンポーネントの実装（作成・編集）
  - 期限切れタスクの視覚的警告表示
  - Shadcn/uiを使用したUIスタイリング
  - コンポーネントの単体テストの作成
  - _Requirements: 1.1, 1.2, 1.4, 10.2_

- [x] 5.2 優先度とフィルタリング機能
  - 優先度（高・中・低）の設定UI
  - フィルタリング条件の設定パネル
  - ソート機能の実装（期限・優先度・作成日）
  - 検索機能の実装
  - _Requirements: 1.2, 1.3, 1.4_

## WBS機能のUI実装

- [x] 6. WBSツリー表示とインタラクション
- [x] 6.1 WBSTreeコンポーネントの実装
  - 階層構造の展開・折りたたみ表示
  - React DnD Kitを使用したドラッグ&ドロップ実装
  - タスクの追加・編集・削除UI
  - 進捗率の視覚的表示（プログレスバー）
  - コンポーネントの単体テストの作成
  - _Requirements: 2.1, 2.2, 2.3, 10.3_

- [x] 6.2 WBS編集とテンプレート機能  
  - インライン編集機能の実装
  - 見積時間の入力と実績時間の記録UI
  - テンプレート保存・読み込み機能
  - 一括操作（展開/折りたたみ、削除）
  - _Requirements: 2.4, 2.5, 2.6, 5.3_

- [x] 6.3 WBS拡張機能の実装（追加実装）
  - ShareGantt推奨レイアウトの実装（視覚的階層表現、番号付け、色分け）
  - タスク粒度管理（2-5日単位での表示と警告）
  - 担当者・レビュー者の表示機能
  - 期限管理と期限切れ警告表示
  - ステータス別の色分け表示（未着手/進行中/作業中/完了）
  - 統計情報の表示（総タスク数、進捗別集計）
  - WBSTreeEnhancedコンポーネントの実装
  - WBSTaskFormEnhancedコンポーネントの実装
  - データベーススキーマの拡張（reviewer, due_date フィールド追加）
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_

- [ ] 6.4 WBSプロフェッショナル機能の実装（更新）
  - 階層番号システムの実装（1, 1.1, 1.1.1形式の自動採番）
  - 整数番号のみの色分け機能（1,2,3,4などを強調表示）
  - 新規タスク作成ボタンでは整数番号のみ作成可能
  - 小数番号は挿入操作でのみ作成可能
  - ドラッグ&ドロップによるタスク順序入替え機能
  - 階層番号の自動再採番（1.1と1.2の入替え時）
  - 小数番号タスクの移動制限（整数番号より上に移動不可）
  - タスク間挿入時の自動番号割当て（ユーザー入力不可）
  - タスク削除機能の実装
  - 整数番号削除時の子タスク（小数番号）一括削除
  - 備考欄の実装（タスク詳細、完了条件、進捗補足情報）
  - 開始日・終了日からの工数自動算出機能
  - エクセルライクなテーブルレイアウト
  - WBSInsertTaskButtonコンポーネントの実装
  - WBSTaskReorderコンポーネントの実装
  - WBSTaskDeleteコンポーネントの実装
  - データベーススキーマの拡張（hierarchy_number, start_date, end_date, work_days, remarks フィールド追加）
  - _Requirements: 2.8, 2.9, 2.10, 2.11, 2.12, 2.13, 2.14_

## カンバンボード機能のUI実装

- [x] 7. カンバンボードの基本実装
- [x] 7.1 KanbanBoardコンポーネント
  - レーン（ToDo、進行中、完了）の表示
  - React DnD Kitを使用したカードのドラッグ&ドロップ
  - カードの作成・編集・削除UI
  - WIP制限の視覚的表示と警告
  - コンポーネントの単体テストの作成
  - _Requirements: 3.1, 3.2, 3.4, 10.3_

- [x] 7.2 カンバンの高度な機能
  - カスタムレーンの追加・削除・編集
  - ラベルによるカテゴリ分けとフィルタリング
  - カードの詳細表示モーダル
  - アーカイブ機能の実装
  - _Requirements: 3.3, 3.5, 3.6_

## ガントチャート機能のUI実装

- [x] 8. ガントチャートの実装
- [x] 8.1 ガントチャートデータモデルとリポジトリのテスト駆動開発
  - GanttTaskエンティティのインターフェース定義とTypeScript型の作成
  - GanttRepositoryの単体テスト作成（Vitest）
  - GanttRepositoryの実装（CRUD操作、階層構造管理、依存関係管理）
  - ガントタスクのデータベーススキーマ実装とマイグレーション
  - SQLite WASMとの統合テスト作成
  - _Requirements: 4.1, 4.8, 4.9, 4.10, 4.12, 4.13_

- [x] 8.2 ガントチャート基本コンポーネントのテスト駆動開発
  - GanttChartコンポーネントの単体テスト作成（Testing Library）
  - タイムライン描画ロジックの実装（日・週・月ビュー）
  - カレンダーヘッダーコンポーネントの実装（年月、日付、曜日表示）
  - タスクリスト表示部分の実装（階層構造対応）
  - 現在日付線の表示実装（赤い縦線）
  - _Requirements: 4.1, 4.6, 4.10, 4.15_

- [x] 8.3 ガントバーとタスク表示機能のテスト駆動開発
  - GanttTaskBarコンポーネントの単体テスト作成
  - タスクバーの描画実装（色分け対応：赤、青、緑、黄、紫）
  - タスクアイコン表示の実装（フォルダ、ドキュメント、人物）
  - 担当者アイコン表示の実装
  - グループ背景色表示の実装
  - _Requirements: 4.8, 4.9, 4.12, 4.13_

- [x] 8.4 ドラッグ&ドロップ機能のテスト駆動開発
  - タスクバードラッグのE2Eテスト作成（Playwright）
  - React DnD Kitを使用したドラッグ実装
  - 開始日・終了日の更新ロジック実装
  - 依存関係の自動調整ロジック実装
  - スナップ機能の実装（日付グリッドへの吸着）
  - _Requirements: 4.2, 4.3_

- [x] 8.5 依存関係とクリティカルパスのテスト駆動開発
  - 依存関係描画の単体テスト作成
  - 矢印描画ロジックの実装（SVG使用）
  - クリティカルパス計算の単体テスト作成
  - クリティカルパス計算アルゴリズムの実装
  - クリティカルパスのハイライト表示実装（赤色強調）
  - _Requirements: 4.3, 4.4, 4.5_

- [x] 8.6 ツールバーとビュー切り替えのテスト駆動開発
  - GanttToolbarコンポーネントの単体テスト作成
  - ビュー切り替えボタンの実装（ガント、リスト、カンバン、カレンダー）
  - メンバー管理ダイアログのE2Eテスト作成
  - メンバー管理、ステータス管理、通知管理UIの実装
  - ズーム機能の実装（表示期間の切り替え）
  - _Requirements: 4.7, 4.11, 4.14_

- [x] 8.7 状態管理とデータ同期のテスト駆動開発
  - Ganttストアの単体テスト作成（Zustand）
  - Ganttストアの実装（状態管理、楽観的更新）
  - WBSタスクとの連携テスト作成
  - データ同期メカニズムの実装
  - リアルタイム更新の実装
  - _Requirements: 4.1, 4.2, 4.3_

- [x] 8.8 ガントチャート機能の統合E2Eテスト
  - タスク作成から表示までのE2Eテスト作成
  - ドラッグ&ドロップによる日程変更のE2Eテスト
  - 依存関係設定と自動調整のE2Eテスト
  - ビュー切り替えのE2Eテスト
  - パフォーマンステストの実装（100タスク以上）
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 4.10, 4.11, 4.12, 4.13, 4.14, 4.15_

## 共通UIコンポーネント（優先実装）

- [x] 9. 共通UIコンポーネント基盤
- [x] 9.1 基本UIコンポーネント
  - 確認ダイアログコンポーネント（削除確認用）
  - 通知システム（トースト表示）
  - ローディング表示とエラー表示
  - ツールチップコンポーネント
  - _Requirements: 6.7, 7.7 の前提条件_

- [x] 9.2 フォームコンポーネント
  - 日付選択コンポーネント
  - 優先度選択コンポーネント
  - メンバー選択コンポーネント
  - ラベル管理コンポーネント
  - _Requirements: 全ツール共通で使用_

## 統合スケジュール管理ツール実装

- [x] 10. データモデル統合（Phase 1 - 1週間）
- [x] 10.1 統一タスクモデルの実装
  - UnifiedTaskインターフェースの定義
  - 統一データベーススキーマの作成（unified_tasks テーブル）
  - 既存データの移行スクリプト作成
  - データ整合性テストの実装
  - _Requirements: 6.1, 6.2, 8.1, 8.2_

- [x] 10.2 統合リポジトリ層の実装
  - UnifiedTaskRepositoryの実装
  - LaneRepositoryの実装
  - DependencyRepositoryの実装
  - 各リポジトリの単体テスト作成
  - _Requirements: 6.3, 6.4, 6.5, 8.3_

- [x] 11. 統合UI基盤（Phase 2 - 1週間）
- [x] 11.1 統合レイアウトコンポーネント
  - IntegratedLayoutコンポーネントの実装
  - ViewSwitcherタブナビゲーションの実装
  - 共通サイドバーの実装
  - レスポンシブ対応（モバイル・タブレット）
  - _Requirements: 7.1, 7.2, 7.3_

- [x] 11.2 共通フィルタ・検索機能
  - UnifiedTaskFilterコンポーネントの実装
  - GlobalSearchコンポーネントの実装
  - フィルタ条件の永続化
  - リアルタイム検索結果表示
  - _Requirements: 6.6, 6.8, 7.3_

- [x] 12. ビュー間連携（Phase 3 - 2週間）
- [x] 12.1 Zustand統合ストア
  - UnifiedTaskStoreの実装
  - ViewStoreの実装
  - FilterStoreの実装
  - ストア間同期メカニズム
  - _Requirements: 6.1, 6.2, 6.3, 7.6_

- [x] 12.2 ビューアダプター
  - TodoAdapterの実装
  - WBSAdapterの実装
  - KanbanAdapterの実装
  - GanttAdapterの実装
  - _Requirements: 6.1, 6.2, 6.3, 6.4_

- [x] 12.3 ドラッグ&ドロップ連携
  - CrossViewDnDフックの実装
  - ビュー間タスク移動機能
  - データ変換ロジック
  - アニメーション実装
  - _Requirements: 6.7, 7.5_

- [ ] 13. 高度な機能とデータ管理（Phase 4 - 1週間）
- [ ] 13.1 統合タスク詳細ダイアログ
  - TaskDetailDialogコンポーネントの実装
  - TaskLinkManagerコンポーネントの実装
  - 関連タスク表示・編集機能
  - 履歴・コメント機能
  - _Requirements: 6.5, 7.4_

- [ ] 13.2 一括操作・通知
  - BulkActionsコンポーネントの実装
  - NotificationCenterコンポーネントの実装
  - 期限通知機能
  - ステータス変更通知
  - _Requirements: 7.7, 8.5_

- [ ] 13.3 インポート・エクスポート機能
  - 統合エクスポート機能（JSON/CSV/Excel）
  - インポート機能（データバリデーション付き）
  - プログレス表示
  - エラーハンドリング
  - _Requirements: 8.3, 8.4, 5.4, 5.5_

- [ ] 14. パフォーマンス最適化とテスト（Phase 5 - 1週間）
- [ ] 14.1 パフォーマンス最適化
  - コンポーネントの遅延ロード実装
  - SQLiteクエリの最適化（インデックス調整）
  - 仮想スクロールの実装（大量データ対応）
  - Service Workerによるオフライン対応
  - _Requirements: パフォーマンス要件_

- [ ] 14.2 統合テスト
  - 統合モデルの単体テスト
  - ビュー間連携の統合テスト
  - データ同期のE2Eテスト（Playwright）
  - クロスブラウザテスト
  - アクセシビリティテスト（WCAG 2.1）
  - _Requirements: 8.6, 6.4_

- [ ] 15. 移行とデプロイ
- [ ] 15.1 本番移行準備
  - データ移行スクリプトの実行
  - 初回チュートリアルの実装
  - ユーザーガイドの作成
  - 段階的な機能公開計画
  - _Requirements: 6.1_