# 実装計画

## プロジェクト基盤構築

- [x] 1. Next.js 14プロジェクトの初期設定とコア設定
  - Next.js 14（App Router）プロジェクトの作成
  - TypeScript 5.xの設定とstrictモードの有効化
  - Tailwind CSSとShadcn/uiのインストール・設定
  - ESLintとPrettierの設定
  - 基本的なレイアウトコンポーネントの作成
  - _Requirements: すべての要件に共通する基盤設定_

- [x] 2. SQLite WASMのセットアップとデータベース基盤
  - SQLite WASMライブラリの導入と初期化
  - データベーススキーマの定義（todos, wbs_tasks, kanban_cards, gantt_tasks）
  - データベース接続ユーティリティの作成
  - マイグレーション処理の実装
  - データベース操作の基本テストの作成
  - _Requirements: 9.1, 9.2, 9.3_

## データアクセス層

- [x] 3. Repositoryパターンの実装
- [x] 3.1 TodoRepositoryの実装
  - TodoエンティティとDTOの定義
  - CRUD操作メソッドの実装（create, read, update, delete）
  - 検索・フィルタリング機能の実装
  - 期限切れタスクの抽出ロジック
  - Repositoryの単体テストの作成
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x] 3.2 WBSRepositoryの実装
  - WBSTaskエンティティとDTOの定義（親子関係を含む）
  - 階層構造の保存・取得メソッドの実装
  - 進捗率の自動計算ロジックの実装
  - タスクの並び替え・移動処理の実装
  - Repositoryの単体テストの作成
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 3.3 KanbanRepositoryの実装
  - KanbanCard、KanbanLaneエンティティの定義
  - カードの作成・移動・削除メソッドの実装
  - レーンの管理メソッドの実装
  - WIP制限のバリデーションロジック
  - Repositoryの単体テストの作成
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.4 GanttRepositoryの実装
  - GanttTaskエンティティの定義（依存関係を含む）
  - タスクのスケジュール管理メソッドの実装
  - 依存関係の検証とクリティカルパス計算
  - 自動日付調整ロジックの実装
  - Repositoryの単体テストの作成
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

## 状態管理層

- [x] 4. Zustandストアの実装
- [x] 4.1 Todoストアの実装
  - TodoストアのState定義とActions定義
  - RepositoryとのインターフェースとReact Queryの統合
  - 楽観的更新とエラーハンドリングの実装
  - ローカルストレージとの同期処理
  - ストアの統合テストの作成
  - _Requirements: 1.1, 1.2, 1.3, 9.2_

- [x] 4.2 WBSストアの実装
  - WBSストアのState定義（階層構造を含む）
  - タスクの追加・更新・削除アクション
  - ドラッグ&ドロップ時の状態更新処理
  - 進捗率の自動更新ロジック
  - ストアの統合テストの作成
  - _Requirements: 2.1, 2.2, 2.3, 2.4_

- [x] 4.3 KanbanストアとGanttストアの実装
  - Kanbanストアの実装（カード移動、レーン管理）
  - Ganttストアの実装（タスク期間変更、依存関係管理）
  - ストア間のデータ同期メカニズム
  - 各ストアの統合テストの作成
  - _Requirements: 3.1, 3.2, 4.1, 4.2_

## UIコンポーネント層

- [x] 5. ToDo管理機能のUI実装
- [x] 5.1 TodoコンポーネントとTodoForm
  - TodoListコンポーネントの実装（表示・フィルタリング）
  - TodoFormコンポーネントの実装（作成・編集）
  - 期限切れタスクの視覚的警告表示
  - Shadcn/uiを使用したUIスタイリング
  - コンポーネントの単体テストの作成
  - _Requirements: 1.1, 1.2, 1.4, 10.2_

- [x] 5.2 優先度とフィルタリング機能
  - 優先度（高・中・低）の設定UI
  - フィルタリング条件の設定パネル
  - ソート機能の実装（期限・優先度・作成日）
  - 検索機能の実装
  - _Requirements: 1.2, 1.3, 1.4_

## WBS機能のUI実装

- [x] 6. WBSツリー表示とインタラクション
- [x] 6.1 WBSTreeコンポーネントの実装
  - 階層構造の展開・折りたたみ表示
  - React DnD Kitを使用したドラッグ&ドロップ実装
  - タスクの追加・編集・削除UI
  - 進捗率の視覚的表示（プログレスバー）
  - コンポーネントの単体テストの作成
  - _Requirements: 2.1, 2.2, 2.3, 10.3_

- [x] 6.2 WBS編集とテンプレート機能  
  - インライン編集機能の実装
  - 見積時間の入力と実績時間の記録UI
  - テンプレート保存・読み込み機能
  - 一括操作（展開/折りたたみ、削除）
  - _Requirements: 2.4, 2.5, 2.6, 5.3_

- [x] 6.3 WBS拡張機能の実装（追加実装）
  - ShareGantt推奨レイアウトの実装（視覚的階層表現、番号付け、色分け）
  - タスク粒度管理（2-5日単位での表示と警告）
  - 担当者・レビュー者の表示機能
  - 期限管理と期限切れ警告表示
  - ステータス別の色分け表示（未着手/進行中/作業中/完了）
  - 統計情報の表示（総タスク数、進捗別集計）
  - WBSTreeEnhancedコンポーネントの実装
  - WBSTaskFormEnhancedコンポーネントの実装
  - データベーススキーマの拡張（reviewer, due_date フィールド追加）
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7_

- [ ] 6.4 WBSプロフェッショナル機能の実装（更新）
  - 階層番号システムの実装（1, 1.1, 1.1.1形式の自動採番）
  - 整数番号のみの色分け機能（1,2,3,4などを強調表示）
  - 新規タスク作成ボタンでは整数番号のみ作成可能
  - 小数番号は挿入操作でのみ作成可能
  - ドラッグ&ドロップによるタスク順序入替え機能
  - 階層番号の自動再採番（1.1と1.2の入替え時）
  - 小数番号タスクの移動制限（整数番号より上に移動不可）
  - タスク間挿入時の自動番号割当て（ユーザー入力不可）
  - タスク削除機能の実装
  - 整数番号削除時の子タスク（小数番号）一括削除
  - 備考欄の実装（タスク詳細、完了条件、進捗補足情報）
  - 開始日・終了日からの工数自動算出機能
  - エクセルライクなテーブルレイアウト
  - WBSInsertTaskButtonコンポーネントの実装
  - WBSTaskReorderコンポーネントの実装
  - WBSTaskDeleteコンポーネントの実装
  - データベーススキーマの拡張（hierarchy_number, start_date, end_date, work_days, remarks フィールド追加）
  - _Requirements: 2.8, 2.9, 2.10, 2.11, 2.12, 2.13, 2.14_

## カンバンボード機能のUI実装

- [ ] 7. カンバンボードの基本実装
- [ ] 7.1 KanbanBoardコンポーネント
  - レーン（ToDo、進行中、完了）の表示
  - React DnD Kitを使用したカードのドラッグ&ドロップ
  - カードの作成・編集・削除UI
  - WIP制限の視覚的表示と警告
  - コンポーネントの単体テストの作成
  - _Requirements: 3.1, 3.2, 3.4, 10.3_

- [ ] 7.2 カンバンの高度な機能
  - カスタムレーンの追加・削除・編集
  - ラベルによるカテゴリ分けとフィルタリング
  - カードの詳細表示モーダル
  - アーカイブ機能の実装
  - _Requirements: 3.3, 3.5, 3.6_

## ガントチャート機能のUI実装

- [ ] 8. ガントチャートの実装
- [ ] 8.1 GanttChartコンポーネントの基本実装
  - タイムライン表示（日・週・月ビュー）
  - タスクバーの表示とドラッグによる期間変更
  - 依存関係の矢印表示
  - クリティカルパスのハイライト表示
  - コンポーネントの単体テストの作成
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 10.4_

- [ ] 8.2 ガントチャートのインタラクション機能
  - タスクバーのリサイズによる期間調整
  - 依存関係の追加・削除UI
  - 進捗率の表示と更新
  - ズーム機能とスクロール同期
  - _Requirements: 4.4, 4.5, 4.6_

## 共通機能の実装

- [ ] 9. データ管理とユーティリティ機能
- [ ] 9.1 インポート/エクスポート機能
  - JSON形式でのデータエクスポート
  - CSVファイルのインポート/エクスポート
  - データバリデーションとエラーハンドリング
  - プログレス表示とキャンセル機能
  - 機能の統合テストの作成
  - _Requirements: 5.1, 5.2_

- [ ] 9.2 共通UIコンポーネント
  - 確認ダイアログコンポーネント
  - 通知システム（トースト表示）
  - ローディング表示とエラー表示
  - ヘルプツールチップとチュートリアル
  - _Requirements: 10.1, 10.2, 10.4_

## ナビゲーションと統合

- [ ] 10. アプリケーション統合
- [ ] 10.1 ナビゲーションとルーティング
  - サイドバーナビゲーションの実装
  - ツール間の切り替えとデータ同期
  - パンくずリストとツール内ナビゲーション
  - レスポンシブ対応（モバイル・タブレット）
  - _Requirements: 6.1, 6.2, 10.1_

- [ ] 10.2 パフォーマンス最適化
  - コンポーネントの遅延ロード実装
  - SQLiteクエリの最適化
  - 仮想スクロールの実装（大量データ対応）
  - Service Workerによるオフライン対応
  - _Requirements: 8.1, 8.2, 8.3, 9.1_

## 最終統合とテスト

- [ ] 11. 統合テストと品質保証
  - E2Eテストの作成（Playwright使用）
  - クロスブラウザテスト（Chrome、Firefox、Safari）
  - アクセシビリティテスト（WCAG 2.1準拠）
  - パフォーマンステスト（Lighthouse）
  - _Requirements: すべての要件のE2E検証_